<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>README</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="htaccess-сниппеты-awesome">
      .htaccess сниппеты
      <a href="https://github.com/sindresorhus/awesome"
        ><img
          src="https://cdn.rawgit.com/sindresorhus/awesome/d7305f38d29fed78fa85652e3a63e154dd8e8829/media/badge.svg"
          alt="Awesome"
      /></a>
    </h1>
    <p>Коллекция .htaccess сниппетов, собранных в одном месте.</p>
    <p>
      <strong>Дисклеймер</strong>: Перед тем, как использовать сниппет в файле
      <code>.htaccess</code>, в большинстве случаев необходимо сделать небольшие
      коррекции (поменять название папки или файла, изменить URL и т.д.).
      Используйте сниппеты на свой страх и риск.
    </p>
    <p>
      <strong>ВАЖНО</strong>: В Apache 2.4 появилось несколько важных изменений,
      особенно в конфигурации управления доступами. Чтобы узнать больше об этих
      и других изменениях перейдите по этой
      <a href="https://httpd.apache.org/docs/2.4/upgrading.html">ссылке</a>, а
      также просмотрите это
      <a href="https://github.com/phanan/htaccess/issues/2">ишью</a>.
    </p>
    <h2 id="поддержка">Поддержка</h2>
    <p>
      Что мы делаем? Здесь собраны самые полезные сниппеты для файла
      <code>.htaccess</code> из всего интернета (например, много разных приемов
      из
      <a href="https://github.com/h5bp/server-configs-apache"
        >Apache Server Configs</a
      >
      мы собрали в одном месте). Не исключено, что мы могли что-то упустить.
      Если вы заметили где-то ошибки или несоответствия, пожалуйста, сообщите
      нам об этом или сделайте Pull Request. Подробнее о том, как помочь проекту
      и делать Pull Request’ы, вы можете прочитать в
      <a href="https://habrahabr.ru/post/275219/">этой статье</a> на Хабрахабр.
    </p>
    <h2 id="содержание">Содержание</h2>
    <ul>
      <li>
        <a href="#rewrite-и-redirect">Rewrite и Redirect</a>
        <ul>
          <li>
            <a href="#Перенаправление-с-без-www-на-с-www"
              >Перенаправление с без www на с www</a
            >
          </li>
          <li>
            <a href="#Перенаправление-с-без-www-на-с-www-для-http-или-https"
              >Перенаправление с без www на с www для HTTP или HTTPS</a
            >
          </li>
          <li>
            <a href="#Перенаправление-с-www-на-без-www"
              >Перенаправление с www на без www</a
            >
          </li>
          <li>
            <a href="#Перенаправление-с-www-на-без-www-для-http-или-https"
              >Перенаправление с www на без www для HTTP или HTTPS</a
            >
          </li>
          <li>
            <a href="#Принудительное-использование-https"
              >Принудительное использование HTTPS</a
            >
          </li>
          <li>
            <a href="#Принудительное-использование-https-за-прокси"
              >Принудительное использование HTTPS за прокси</a
            >
          </li>
          <li>
            <a href="#Вставить-завершающий-слэш">Вставить завершающий слэш</a>
          </li>
          <li>
            <a href="#Удалить-завершающий-слэш">Удалить завершающий слэш</a>
          </li>
          <li>
            <a href="#Редирект-со-страницы-на-страницу"
              >Редирект со страницы на страницу</a
            >
          </li>
          <li>
            <a href="#Редирект-с-использованием-redirectmatch"
              >Редирект с использованием RedirectMatch</a
            >
          </li>
          <li>
            <a href="#Алиас-для-определенной-директории"
              >Алиас для определенной директории</a
            >
          </li>
          <li><a href="#Алиас-пути-до-скрипта">Алиас пути до скрипта</a></li>
          <li><a href="#Редирект-всего-сайта">Редирект всего сайта</a></li>
          <li>
            <a href="#Использовать-чистые-url">Использовать чистые URL</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#Безопасность">Безопасность</a>
        <ul>
          <li><a href="#Запретить-доступ-всем">Запретить доступ всем</a></li>
          <li>
            <a href="#Запретить-доступ-всем-кроме"
              >Запретить доступ всем, кроме…</a
            >
          </li>
          <li>
            <a href="#Разрешить-доступ-всем-кроме"
              >Разрешить доступ всем, кроме…</a
            >
          </li>
          <li>
            <a href="#Запретить-доступ-к-скрытым-файлам-и-директориям"
              >Запретить доступ к скрытым файлам и директориям</a
            >
          </li>
          <li>
            <a href="#Запретить-доступ-к-файлам">Запретить доступ к файлам</a>
          </li>
          <li>
            <a href="#Запретить-листинг-директорий"
              >Запретить листинг директорий</a
            >
          </li>
          <li>
            <a href="#Запретить-хотлинкинг-изображений"
              >Запретить хотлинкинг изображений</a
            >
          </li>
          <li>
            <a href="#Запретить-хотлинкинг-изображений-для-определенных-доменов"
              >Запретить хотлинкинг изображений для определенных доменов</a
            >
          </li>
          <li>
            <a href="#Защитить-паролем-директорию"
              >Защитить паролем директорию</a
            >
          </li>
          <li>
            <a href="#Защитить-паролем-один-или-несколько-файлов"
              >Защитить паролем один или несколько файлов</a
            >
          </li>
          <li>
            <a href="#Заблокировать-посетителя-по-referrer"
              >Заблокировать посетителя по Referrer</a
            >
          </li>
          <li>
            <a href="#Запретить-рендеринг-сайта-во-фрейме"
              >Запретить рендеринг сайта во фрейме</a
            >
          </li>
        </ul>
      </li>
      <li>
        <a href="#Производительность">Производительность</a>
        <ul>
          <li>
            <a href="#Сжатие-текстовых-файлов">Сжатие текстовых файлов</a>
          </li>
          <li>
            <a href="#Установить-expires-headers">Установить Expires Headers</a>
          </li>
          <li><a href="#Выключить-etags">Выключить eTags</a></li>
        </ul>
      </li>
      <li>
        <a href="#Разное">Разное</a>
        <ul>
          <li><a href="#Настройка-php">Настройка PHP</a></li>
          <li>
            <a href="#Пользовательские-страницы-ошибок"
              >Пользовательские страницы ошибок</a
            >
          </li>
          <li>
            <a
              href="#Принудительная-загрузка-скачивать-файл-вместо-отображения-в-браузере"
              >Принудительная загрузка (скачивать файл вместо отображения в
              браузере)</a
            >
          </li>
          <li>
            <a href="#Запретить-загрузку-отображать-plain-в-браузере"
              >Запретить загрузку (отображать plain в браузере)</a
            >
          </li>
          <li>
            <a href="#Разрешить-кроссдоменные-шрифты"
              >Разрешить кроссдоменные шрифты</a
            >
          </li>
          <li>
            <a href="#Установить-по-умолчанию-кодировку-utf-8"
              >Установить по умолчанию кодировку UTF-8</a
            >
          </li>
          <li>
            <a href="#Переключиться-на-другую-версию-php"
              >Переключиться на другую версию PHP</a
            >
          </li>
          <li>
            <a href="#Выключить-режим-совместимости-в-internet-explorer"
              >Выключить режим совместимости в Internet Explorer</a
            >
          </li>
          <li>
            <a href="#Обработка-webp-изображений">Обработка WebP изображений</a>
          </li>
        </ul>
      </li>
    </ul>
    <h2 id="rewrite-и-redirect">Rewrite и Redirect</h2>
    <p>
      Примечание: Предполагается, что модуль <code>mod_rewrite</code> установлен
      и включен.
    </p>
    <h3 id="перенаправление-с-без-www-на-с-www">
      Перенаправление с без www на с www
    </h3>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^example\.com [NC]
RewriteRule ^(.*)$ http://www.example.com/$1 [L,R=301,NC]</code></pre>
    <h3 id="перенаправление-с-без-www-на-с-www-для-http-или-https">
      Перенаправление с без www на с www для HTTP или HTTPS
    </h3>
    <pre class="apacheconf"><code>RewriteCond %{HTTP_HOST} !^$
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTPS}s ^on(s)|
RewriteRule ^ http%1://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]</code></pre>
    <p>
      Это работает для <em>любого</em> домена.
      <a
        href="https://stackoverflow.com/questions/4916222/htaccess-how-to-force-www-in-a-generic-way"
        >Источник</a
      >
    </p>
    <h3 id="перенаправление-с-www-на-без-www">
      Перенаправление с www на без www
    </h3>
    <p>
      Это <a href="http://www.sitepoint.com/domain-www-or-no-www/">вечная</a>
      <a href="https://devcenter.heroku.com/articles/apex-domains">тема</a>
      <a href="http://yes-www.org/">для</a>
      <a href="http://no-www.org/">дискуссий</a> - использовать или не
      использовать www, но если вы поклонник “чистых” доменов, то:
    </p>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^www\.example\.com [NC]
RewriteRule ^(.*)$ http://example.com/$1 [L,R=301]</code></pre>
    <h3 id="перенаправление-с-www-на-без-www-для-http-или-https">
      Перенаправление с www на без www для HTTP или HTTPS
    </h3>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^www\.
RewriteCond %{HTTPS}s ^on(s)|off
RewriteCond http%1://%{HTTP_HOST} ^(https?://)(www\.)?(.+)$
RewriteRule ^ %1%3%{REQUEST_URI} [R=301,L]</code></pre>
    <h3 id="принудительное-использование-https">
      Принудительное использование HTTPS
    </h3>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTPS} !on
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

# Примечание: Рекомендуется включить HTTP Strict Transport Security (HSTS)
# на вашем HTTPS сайте для предотвращения атак посредника (man-in-the-middle).
# https://developer.mozilla.org/en-US/docs/Web/Security/HTTP_strict_transport_security
&lt;IfModule mod_headers.c&gt;
    Header always set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;
&lt;/IfModule&gt;</code></pre>
    <h3 id="принудительное-использование-https-за-прокси">
      Принудительное использование HTTPS за прокси
    </h3>
    <p>Полезно, если вы имеете прокси перед вашим сервером для TLS.</p>
    <pre class="apacheconf"><code>RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}</code></pre>
    <h3 id="вставить-завершающий-слэш">Вставить завершающий слэш</h3>
    <pre class="apacheconf"><code>RewriteCond %{REQUEST_URI} /+[^\.]+$
RewriteRule ^(.+[^/])$ %{REQUEST_URI}/ [R=301,L]</code></pre>
    <h3 id="удалить-завершающий-слэш">Удалить завершающий слэш</h3>
    <p>
      Этот сниппет перенаправляет из пути, который заканчивается на слэш, на
      путь без завершающего слэша (кроме реальных директорий), например, из
      <code>http://www.example.com/blog/</code> перенаправит на
      <code>http://www.example.com/blog</code>. Это важно для SEO, так как
      <a href="http://overit.com/blog/canonical-urls">рекомендуется</a>, чтобы
      каждая страница имела канонический URL.
    </p>
    <pre class="apacheconf"><code>RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]</code></pre>
    <p>
      <a
        href="https://stackoverflow.com/questions/21417263/htaccess-add-remove-trailing-slash-from-url#27264788"
        >Источник</a
      >
    </p>
    <h3 id="редирект-со-страницы-на-страницу">
      Редирект со страницы на страницу
    </h3>
    <pre
      class="apacheconf"
    ><code>Redirect 301 /oldpage.html http://www.example.com/newpage.html
Redirect 301 /oldpage2.html http://www.example.com/folder/</code></pre>
    <p>
      <a href="http://css-tricks.com/snippets/htaccess/301-redirects/"
        >Источник</a
      >
    </p>
    <h3 id="редирект-с-использованием-redirectmatch">
      Редирект с использованием RedirectMatch
    </h3>
    <pre
      class="apacheconf"
    ><code>RedirectMatch 301 /subdirectory(.*) http://www.newsite.com/newfolder/$1
RedirectMatch 301 ^/(.*).htm$ /$1.html
RedirectMatch 301 ^/200([0-9])/([^01])(.*)$ /$2$3
RedirectMatch 301 ^/category/(.*)$ /$1
RedirectMatch 301 ^/(.*)/htaccesselite-ultimate-htaccess-article.html(.*) /htaccess/htaccess.html
RedirectMatch 301 ^/(.*).html/1/(.*) /$1.html$2
RedirectMatch 301 ^/manual/(.*)$ http://www.php.net/manual/$1
RedirectMatch 301 ^/dreamweaver/(.*)$ /tools/$1
RedirectMatch 301 ^/z/(.*)$ http://static.askapache.com/$1</code></pre>
    <p>
      <a
        href="http://www.askapache.com/htaccess/301-redirect-with-mod_rewrite-or-redirectmatch.html#301_Redirects_RedirectMatch"
        >Источник</a
      >
    </p>
    <h3 id="алиас-для-определенной-директории">
      Алиас для определенной директории
    </h3>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteRule ^source-directory/(.*) /target-directory/$1 [R=301,L]</code></pre>
    <h3 id="алиас-пути-до-скрипта">Алиас пути до скрипта</h3>
    <pre class="apacheconf"><code>FallbackResource /index.fcgi</code></pre>
    <p>
      В этом примере приведён файл <code>index.fcgi</code>, который лежит в
      каталоге и все запросы к этому каталогу, которые потерпели неудачу из-за
      отсутствия файла/директории будут перенаправлены на скрипт
      <code>index.fcgi</code>. Это хорошо, если вы хотите, чтобы
      <code>baz.foo/some/cool/path</code> обрабатывался скриптом
      <code>baz.foo/index.fcgi</code> (который также поддерживает запросы на
      <code>baz.foo</code>) в тоже время поддерживается
      <code>baz.foo/css/style.css</code> и другое подобное. Узнать истинный путь
      можно из переменной окружения PATH_INFO, которая доступна в скриптах.
    </p>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteRule ^$ index.fcgi/ [QSA,L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.fcgi/$1 [QSA,L]</code></pre>
    <p>
      Это менее эффективная версия директивы
      <code>FallbackResource</code> (поскольку использование
      <code>mod_rewrite</code> сложнее, чем просто обработка директивой
      <code>FallbackResource</code>), но также и более гибкое.
    </p>
    <h3 id="редирект-всего-сайта">Редирект всего сайта</h3>
    <pre
      class="apacheconf"
    ><code>Redirect 301 / http://newsite.com/</code></pre>
    <p>
      Этот сайт не “ломает” ссылки. Этот путь
      <code>www.oldsite.com/some/crazy/link.html</code> перенаправит вас на
      <code>www.newsite.com/some/crazy/link.html</code>. Это очень полезно,
      когда вы просто переносите сайт на новый домен.
      <a href="http://css-tricks.com/snippets/htaccess/301-redirects/"
        >Источник</a
      >
    </p>
    <h3 id="использовать-чистые-url">Использовать чистые URL</h3>
    <p>
      Этот сниппет позволяет использовать “чистые” URL – без расширения .php,
      например, <code>example.com/users</code> вместо
      <code>example.com/users.php</code>.
    </p>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteRule ^([^.]+)$ $1.php [NC,L]</code></pre>
    <p>
      <a
        href="http://www.abeautifulsite.net/access-pages-without-the-php-extension-using-htaccess/"
        >Источник</a
      >
    </p>
    <h2 id="безопасность">Безопасность</h2>
    <h3 id="запретить-доступ-всем">Запретить доступ всем</h3>
    <pre class="apacheconf"><code>## Apache 2.2
Deny from all

## Apache 2.4
# Require all denied</code></pre>
    <p>
      Подождите-ка, этот сниппет заблокирует доступ к сайту даже для вас! Сейчас
      исправим это…
    </p>
    <h3 id="запретить-доступ-всем-кроме">Запретить доступ всем, кроме…</h3>
    <pre class="apacheconf"><code>## Apache 2.2
Order deny,allow
Deny from all
Allow from xxx.xxx.xxx.xxx

## Apache 2.4
# Require all denied
# Require ip xxx.xxx.xxx.xxx</code></pre>
    <p>
      <code>xxx.xxx.xxx.xxx</code> - это ваш IP. Если вы замените последние три
      цифры, например, на <code>0/12</code>, этим вы определите диапазон IP
      внутри этой сети и это оградит вас от проблемы перечислять по отдельности
      все разрешённые IP.
      <a
        href="http://speckyboy.com/2013/01/08/useful-htaccess-snippets-and-hacks/"
        >Источник</a
      >
    </p>
    <p>И, естественно, противоположная функция к этой:</p>
    <h3 id="разрешить-доступ-всем-кроме">Разрешить доступ всем, кроме…</h3>
    <pre class="apacheconf"><code>## Apache 2.2
Order deny,allow
Deny from xxx.xxx.xxx.xxx
Deny from xxx.xxx.xxx.xxy

## Apache 2.4
# Require all granted
# Require not ip xxx.xxx.xxx.xxx
# Require not ip xxx.xxx.xxx.xxy</code></pre>
    <h3 id="запретить-доступ-к-скрытым-файлам-и-директориям">
      Запретить доступ к скрытым файлам и директориям
    </h3>
    <p>
      Скрытые файлы и директории (те, чьи имена начинаются с точки
      <code>.</code>) должны в большинстве, если не все, быть недоступны для
      других. Например: <code>.htaccess</code>, <code>.htpasswd</code>,
      <code>.git</code>, <code>.hg</code>…
    </p>
    <pre class="apacheconf"><code>RewriteCond %{SCRIPT_FILENAME} -d [OR]
RewriteCond %{SCRIPT_FILENAME} -f
RewriteRule &quot;(^|/)\.&quot; - [F]</code></pre>
    <p>
      Как вариант, вы можете показывать ошибку Not Found (не найдено), чтобы не
      давать атакующему подсказку:
    </p>
    <pre class="apacheconf"><code>RedirectMatch 404 /\..*$</code></pre>
    <h3 id="запретить-доступ-к-файлам">Запретить доступ к файлам</h3>
    <p>
      Эти файлы могут быть оставлены некоторыми редакторами text/html (вроде
      Vi/Vim) и представляют огромную дыру в безопасности, если станут
      общедоступными.
    </p>
    <pre
      class="apacheconf"
    ><code>&lt;FilesMatch &quot;(\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|swp)|~)$&quot;&gt;
    ## Apache 2.2
    Order allow,deny
    Deny from all
    Satisfy All

    ## Apache 2.4
    # Require all denied
&lt;/FilesMatch&gt;</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Источник</a></p>
    <h3 id="запретить-листинг-директорий">Запретить листинг директорий</h3>
    <pre class="apacheconf"><code>Options All -Indexes</code></pre>
    <h3 id="запретить-хотлинкинг-изображений">
      Запретить хотлинкинг изображений
    </h3>
    <pre class="apacheconf"><code>RewriteEngine on
# Удалите эту строчку, если вы хотите заблокировать пользователя с пустым Referrer
RewriteCond %{HTTP_REFERER} !^$

RewriteCond %{HTTP_REFERER} !^https?://(.+\.)?example.com [NC]
RewriteRule \.(jpe?g|png|gif|bmp)$ - [NC,F,L]

# Если вы захотите отображать вместо заблокированного изображения свой баннер,
# то замените правило выше на это:
# RewriteRule \.(jpe?g|png|gif|bmp) http://example.com/blocked.png [R,L]</code></pre>
    <h3 id="запретить-хотлинкинг-изображений-для-определенных-доменов">
      Запретить хотлинкинг изображений для определенных доменов
    </h3>
    <p>
      Иногда вам потребуется запретить хотлинкинг только для некоторых доменов.
    </p>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_REFERER} ^https?://(.+\.)?badsite\.com [NC,OR]
RewriteCond %{HTTP_REFERER} ^https?://(.+\.)?badsite2\.com [NC,OR]
RewriteRule \.(jpe?g|png|gif|bmp)$ - [NC,F,L]

# Если вы захотите отображать вместо заблокированного изображения свой баннер,
# то замените правило выше на это:
# RewriteRule \.(jpe?g|png|gif|bmp) http://example.com/blocked.png [R,L]</code></pre>
    <h3 id="защитить-паролем-директорию">Защитить паролем директорию</h3>
    <p>
      Сначала нужно создать файл <code>.htpasswd</code> в определенной
      директории:
    </p>
    <div class="sourceCode" id="cb25">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1"><span class="ex">htpasswd</span> -c /home/fellowship/.htpasswd ваш_суперсекретный_пароль</a></code></pre>
    </div>
    <p>И потом использовать этот файл для аутентификации:</p>
    <pre class="apacheconf"><code>AuthType Basic
AuthName &quot;One does not simply&quot;
AuthUserFile /home/fellowship/.htpasswd
Require valid-user</code></pre>
    <h3 id="защитить-паролем-один-или-несколько-файлов">
      Защитить паролем один или несколько файлов
    </h3>
    <pre class="apacheconf"><code>AuthName &quot;One still does not simply&quot;
AuthType Basic
AuthUserFile /home/fellowship/.htpasswd

&lt;Files &quot;one-ring.o&quot;&gt;
Require valid-user
&lt;/Files&gt;

&lt;FilesMatch ^((one|two|three)-rings?\.o)$&gt;
Require valid-user
&lt;/FilesMatch&gt;</code></pre>
    <h3 id="заблокировать-посетителя-по-referrer">
      Заблокировать посетителя по Referrer
    </h3>
    <p>
      Блокирует доступ для всех пользователей, которые пришли (были
      перенаправлены) из определенного домена(-ов).
      <a href="http://www.htaccess-guide.com/deny-visitors-by-referrer/"
        >Источник</a
      >
    </p>
    <pre class="apacheconf"><code>RewriteEngine on
# Options +FollowSymlinks
RewriteCond %{HTTP_REFERER} somedomain\.com [NC,OR]
RewriteCond %{HTTP_REFERER} anotherdomain\.com
RewriteRule .* - [F]</code></pre>
    <h3 id="запретить-рендеринг-сайта-во-фрейме">
      Запретить рендеринг сайта во фрейме
    </h3>
    <p>
      Этот сниппет запрещает отображение сайта во фрейме (например, в теге
      <code>iframe</code>), но разрешает отображение сайта во фрейме для
      определенных URI.
    </p>
    <pre
      class="apacheconf"
    ><code>SetEnvIf Request_URI &quot;/starry-night&quot; allow_framing=true
Header set X-Frame-Options SAMEORIGIN env=!allow_framing</code></pre>
    <h2 id="производительность">Производительность</h2>
    <h3 id="сжатие-текстовых-файлов">Сжатие текстовых файлов</h3>
    <pre class="apacheconf"><code>&lt;IfModule mod_deflate.c&gt;

    # Принудительное сжатие для исковерканных заголовков.
    # https://developer.yahoo.com/blogs/ydn/pushing-beyond-gzipping-25601.html
    &lt;IfModule mod_setenvif.c&gt;
        &lt;IfModule mod_headers.c&gt;
            SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s*,?\s*)+|[X~-]{4,13}$ HAVE_Accept-Encoding
            RequestHeader append Accept-Encoding &quot;gzip,deflate&quot; env=HAVE_Accept-Encoding
        &lt;/IfModule&gt;
    &lt;/IfModule&gt;

    # Сжимать исходящие данные с одним из следующих MIME типов
    # (для Apache ниже версии 2.3.7 не нужно включать `mod_filter`
    # и вы можете удалить строки `&lt;IfModule mod_filter.c&gt;` и `&lt;/IfModule&gt;`
    # так как `AddOutputFilterByType` все еще есть в ядре Apache).
    &lt;IfModule mod_filter.c&gt;
        AddOutputFilterByType DEFLATE application/atom+xml \
                                      application/javascript \
                                      application/json \
                                      application/rss+xml \
                                      application/vnd.ms-fontobject \
                                      application/x-font-ttf \
                                      application/x-web-app-manifest+json \
                                      application/xhtml+xml \
                                      application/xml \
                                      font/opentype \
                                      image/svg+xml \
                                      image/x-icon \
                                      text/css \
                                      text/html \
                                      text/plain \
                                      text/x-component \
                                      text/xml
    &lt;/IfModule&gt;

&lt;/IfModule&gt;</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Источник</a></p>
    <h3 id="установить-expires-headers">Установить Expires Headers</h3>
    <p>
      <em>Expires headers</em> говорят браузеру, должен ли он загружать файл из
      сервера или же из кэша. Для статичного контента рекомендуется установить
      <code>Expires</code> заголовки на что-нибудь далекое в будущем.
    </p>
    <p>
      Если вы не контролируете изменение версий с помощью перебора, основанного
      на файлах, подумайте о том, чтобы уменьшить время кэша для CSS и JS,
      например, до 1 недели.
      <a href="https://github.com/h5bp/server-configs-apache">Источник</a>
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_expires.c&gt;
    ExpiresActive on
    ExpiresDefault                                      &quot;access plus 1 month&quot;

  # CSS
    ExpiresByType text/css                              &quot;access plus 1 year&quot;

  # Данные
    ExpiresByType application/json                      &quot;access plus 0 seconds&quot;
    ExpiresByType application/xml                       &quot;access plus 0 seconds&quot;
    ExpiresByType text/xml                              &quot;access plus 0 seconds&quot;

  # Favicon
    ExpiresByType image/x-icon                          &quot;access plus 1 week&quot;

  # HTML компоненты (HTCs)
    ExpiresByType text/x-component                      &quot;access plus 1 month&quot;

  # HTML
    ExpiresByType text/html                             &quot;access plus 0 seconds&quot;

  # JavaScript
    ExpiresByType application/javascript                &quot;access plus 1 year&quot;

  # Файлы манифеста (Manifest)
    ExpiresByType application/x-web-app-manifest+json   &quot;access plus 0 seconds&quot;
    ExpiresByType text/cache-manifest                   &quot;access plus 0 seconds&quot;

  # Медиа
    ExpiresByType audio/ogg                             &quot;access plus 1 month&quot;
    ExpiresByType image/gif                             &quot;access plus 1 month&quot;
    ExpiresByType image/jpeg                            &quot;access plus 1 month&quot;
    ExpiresByType image/png                             &quot;access plus 1 month&quot;
    ExpiresByType video/mp4                             &quot;access plus 1 month&quot;
    ExpiresByType video/ogg                             &quot;access plus 1 month&quot;
    ExpiresByType video/webm                            &quot;access plus 1 month&quot;

  # Фиды
    ExpiresByType application/atom+xml                  &quot;access plus 1 hour&quot;
    ExpiresByType application/rss+xml                   &quot;access plus 1 hour&quot;

  # Web шрифты
    ExpiresByType application/font-woff2                &quot;access plus 1 month&quot;
    ExpiresByType application/font-woff                 &quot;access plus 1 month&quot;
    ExpiresByType application/vnd.ms-fontobject         &quot;access plus 1 month&quot;
    ExpiresByType application/x-font-ttf                &quot;access plus 1 month&quot;
    ExpiresByType font/opentype                         &quot;access plus 1 month&quot;
    ExpiresByType image/svg+xml                         &quot;access plus 1 month&quot;
&lt;/IfModule&gt;</code></pre>
    <h3 id="выключить-etags">Выключить eTags</h3>
    <p>
      Удаляя заголовок <code>ETag</code>, вы выключаете кэш и избавляете
      возможности проверять браузером файлы, следовательно они будут полагаться
      на заголовки <code>Cache-Control</code> и <code>Expires</code>.
      <a href="http://www.askapache.com/htaccess/apache-speed-etags.html"
        >Источник</a
      >
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_headers.c&gt;
    Header unset ETag
&lt;/IfModule&gt;
FileETag None</code></pre>
    <h2 id="разное">Разное</h2>
    <h3 id="настройка-php">Настройка PHP</h3>
    <pre class="apacheconf"><code>php_value &lt;key&gt; &lt;val&gt;

# Например:
php_value upload_max_filesize 50M
php_value max_execution_time 240</code></pre>
    <h3 id="пользовательские-страницы-ошибок">
      Пользовательские страницы ошибок
    </h3>
    <pre
      class="apacheconf"
    ><code>ErrorDocument 500 &quot;Хьюстон, у нас проблемы.&quot;
ErrorDocument 401 http://error.example.com/mordor.html
ErrorDocument 404 /errors/halflife3.html</code></pre>
    <h3
      id="принудительная-загрузка-скачивать-файл-вместо-отображения-в-браузере"
    >
      Принудительная загрузка (скачивать файл вместо отображения в браузере)
    </h3>
    <p>
      Иногда нужно загрузить запрашиваемый файл, а не отображать его в браузере.
    </p>
    <pre class="apacheconf"><code>&lt;Files *.md&gt;
    ForceType application/octet-stream
    Header set Content-Disposition attachment
&lt;/Files&gt;</code></pre>
    <p>А ниже сниппет, который делает это с точностью до наоборот:</p>
    <h3 id="запретить-загрузку-отображать-plain-в-браузере">
      Запретить загрузку (отображать plain в браузере)
    </h3>
    <p>
      Иногда нужно отобразить запрашиваемый файл в браузере, а не загружать его.
    </p>
    <pre
      class="apacheconf"
    ><code>&lt;FilesMatch &quot;\.(tex|log|aux)$&quot;&gt;
    Header set Content-Type text/plain
&lt;/FilesMatch&gt;</code></pre>
    <h3 id="разрешить-кроссдоменные-шрифты">Разрешить кроссдоменные шрифты</h3>
    <p>
      Шрифты, которые хранятся на CDN серверах, могут не работать в Firefox и IE
      из-за
      <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"
        >CORS</a
      >. Данный сниппет решает эту проблему.
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_headers.c&gt;
    &lt;FilesMatch &quot;\.(eot|otf|ttc|ttf|woff|woff2)$&quot;&gt;
        Header set Access-Control-Allow-Origin &quot;*&quot;
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;</code></pre>
    <p>
      <a href="https://github.com/h5bp/server-configs-apache/issues/32"
        >Источник</a
      >
    </p>
    <h3 id="установить-по-умолчанию-кодировку-utf-8">
      Установить по умолчанию кодировку UTF-8
    </h3>
    <p>
      Ваш текстовый контент должен быть всегда закодирован в UTF-8, не так ли?
    </p>
    <pre
      class="apacheconf"
    ><code># Используйте кодировку UTF-8 для обработки text/plain или text/html
AddDefaultCharset utf-8

# Принудительное использование UTF-8 для различных файлов
AddCharset utf-8 .atom .css .js .json .rss .vtt .xml</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Источник</a></p>
    <h3 id="переключиться-на-другую-версию-php">
      Переключиться на другую версию PHP
    </h3>
    <p>
      Если вы используете шаред хостинг, вполне вероятно, что там установлено
      несколько версий PHP. Но вам нужна конкретная версия PHP для вашего
      веб-сайта. Этот сниппет должен переключить PHP версию.
    </p>
    <pre class="apacheconf"><code>AddHandler application/x-httpd-php56 .php

# В качестве альтернативы вы можете использовать AddType
AddType application/x-httpd-php56 .php</code></pre>
    <h3 id="выключить-просмотр-в-режиме-совместимости-в-internet-explorer">
      Выключить просмотр в режиме совместимости в Internet Explorer
    </h3>
    <p>
      Просмотр в режиме совместимости в IE может оказать влияние на то, как
      отображаются некоторые сайты. Этот сниппет заставляет IE использовать
      движок Edge Rendering и выключает просмотр в режиме совместимости.
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_headers.c&gt;
    BrowserMatch MSIE is-msie
    Header set X-UA-Compatible IE=edge env=is-msie
&lt;/IfModule&gt;</code></pre>
    <h3 id="обработка-webp-изображений">Обработка WebP изображений</h3>
    <p>
      Если
      <a href="https://developers.google.com/speed/webp/?csw=1"
        >WebP изображения</a
      >
      поддерживаюся и изображения с расширениями .webp и теми же именами найдены
      в том же месте, где и изображения jpg/png, которые нужно отправить, то
      тогда вместо них отправляются изображения WebP.
    </p>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteCond %{HTTP_ACCEPT} image/webp
RewriteCond %{DOCUMENT_ROOT}/$1.webp -f
RewriteRule (.+)\.(jpe?g|png)$ $1.webp [T=image/webp,E=accept:1]</code></pre>
    <p>
      <a href="https://github.com/vincentorback/WebP-images-with-htaccess"
        >Источник</a
      >
    </p>
  </body>
</html>
