<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>README</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="htaccess-snippets-awesome">
      .htaccess Snippets
      <a href="https://github.com/sindresorhus/awesome"
        ><img
          src="https://cdn.rawgit.com/sindresorhus/awesome/d7305f38d29fed78fa85652e3a63e154dd8e8829/media/badge.svg"
          alt="Awesome"
      /></a>
    </h1>
    <blockquote>
      <p>
        Une collection utile de fragments de configuration de fichier
        <code>.htaccess</code>, le tout regroupé dans un seul endroit.
      </p>
    </blockquote>
    <p>
      <strong>Avertissement</strong> : Bien que l’extrait mis dans un fichier
      <code>.htaccess</code> est la plupart du temps suffisant, il ya des cas où
      certaines modifications pourraient être nécessaires. À utiliser à vos
      propres risques.
    </p>
    <p>
      <strong>IMPORTANT</strong> : Apache 2.4 a introduit quelques changements
      de rupture, notamment dans la configuration de contrôle d’accès. Pour plus
      d’information, consultez le
      <a href="https://httpd.apache.org/docs/2.4/upgrading.html"
        >document de mise à niveau</a
      >
      ainsi que
      <a href="https://github.com/phanan/htaccess/issues/2">cette issue</a>.
    </p>
    <h2 id="crédits">Crédits</h2>
    <p>
      Ce que nous faisons ici est principalement la collection d’extraits
      pratiques en provenance d’un peu partout sur le web, par exemple, une
      bonne partie provient du dépôt
      <a href="https://github.com/h5bp/server-configs-apache"
        >Apache Server Configs</a
      >. Bien qu’ayant essayé de créditer la bonne personne, des éléments
      peuvent être manquants. Si vous pensez que quelque chose ici provient de
      votre travail et que vous devriez en être crédité, faites le moi savoir,
      ou faites une PR.
    </p>
    <h2 id="table-des-matières">Table des matières</h2>
    <ul>
      <li>
        <a href="#réécriture-et-redirection">Réécriture et redirection</a>
        <ul>
          <li><a href="#forcer-www">Forcer www</a></li>
          <li>
            <a href="#forcer-www-dune-manière-générique"
              >Forcer www d’une manière générique</a
            >
          </li>
          <li><a href="#forcer-non-www">Forcer non-www</a></li>
          <li>
            <a href="#forcer-non-www-dune-manière-générique"
              >Forcer non-www d’une manière générique</a
            >
          </li>
          <li><a href="#forcer-https">Forcer HTTPS</a></li>
          <li>
            <a href="#forcer-https-derrière-un-proxy"
              >Forcer HTTPS derrière un proxy</a
            >
          </li>
          <li><a href="#forcer-le-slash-de-fin">Forcer le slash de fin</a></li>
          <li>
            <a href="#supprimer-le-slash-de-fin">Supprimer le slash de fin</a>
          </li>
          <li>
            <a href="#rediriger-une-seule-page">Rediriger une seule page</a>
          </li>
          <li>
            <a href="#alias-pour-un-seul-dossier">Alias pour un seul dossier</a>
          </li>
          <li>
            <a href="#alias-de-chemins-vers-un-script"
              >Alias de chemins vers un script</a
            >
          </li>
          <li>
            <a href="#rediriger-un-site-entier">Rediriger un site entier</a>
          </li>
          <li><a href="#alias-en-urls-propres">Alias en URLs propres</a></li>
        </ul>
      </li>
      <li>
        <a href="#securité">Sécurité</a>
        <ul>
          <li><a href="#refuser-tout-accès">Refuser tout accès</a></li>
          <li>
            <a href="#refuser-tout-accès-sauf-soi-même"
              >Refuser tout accès sauf soi-même</a
            >
          </li>
          <li>
            <a href="#autoriser-tout-accès-sauf-aux-spammeurs"
              >Autoriser tout accès sauf aux spammeurs’</a
            >
          </li>
          <li>
            <a href="#refuser-laccès-aux-fichiers-et-dossiers-cachés"
              >Refuser l’accès aux fichiers et répertoires cachés</a
            >
          </li>
          <li>
            <a href="#refuser-laccès-aux-sources-et-fichiers-de-sauvegarde"
              >Refuser l’accès aux sources et fichiers de sauvegarde</a
            >
          </li>
          <li>
            <a href="#désactiver-la-navigation-de-dossier"
              >Désactiver la navigation de dossier</a
            >
          </li>
          <li>
            <a href="#désactiver-le-hotlink-des-images"
              >Désactiver le hotlink des images</a
            >
          </li>
          <li>
            <a
              href="#désactiver-le-hotlink-des-images-pour-des-domaines-spécifiques"
              >Désactiver le hotlink des images pour des domaines spécifiques</a
            >
          </li>
          <li>
            <a href="#protéger-un-dossier-par-mot-de-passe"
              >Protéger un dossier par mot de passe</a
            >
          </li>
          <li>
            <a href="#protéger-un-ou-plusieurs-fichiers-par-mot-de-passe"
              >Protéger un ou plusieurs fichiers par mot de passe</a
            >
          </li>
        </ul>
      </li>
      <li>
        <a href="#performance">Performance</a>
        <ul>
          <li>
            <a href="#compresser-les-fichiers-texte"
              >Compresser les fichiers texte</a
            >
          </li>
          <li>
            <a href="#ajouter-len-tête-expires">Ajouter l’en-tête “Expires”</a>
          </li>
          <li><a href="#désactiver-etags">Désactiver eTags</a></li>
        </ul>
      </li>
      <li>
        <a href="#divers">Divers</a>
        <ul>
          <li>
            <a href="#définir-des-variables-php">Définir des variables PHP</a>
          </li>
          <li>
            <a href="#pages-derreur-personnalisées"
              >Pages d’erreur personnalisées</a
            >
          </li>
          <li>
            <a href="#forcer-le-téléchargement">Forcer le téléchargement</a>
          </li>
          <li>
            <a href="#empêcher-le-téléchargement">Empêcher le téléchargement</a>
          </li>
          <li>
            <a href="#autoriser-les-polices-cross-domain"
              >Autoriser les polices Cross-Domain</a
            >
          </li>
          <li>
            <a href="#encodage-utf-8-automatique">Encodage UTF-8 automatique</a>
          </li>
          <li>
            <a href="#basculer-vers-une-autre-version-de-php"
              >Basculer vers une autre version de PHP</a
            >
          </li>
          <li>
            <a
              href="#désactiver-le-mode-de-compatibilité-pour-internet-explorer"
              >Désactiver le mode de compatibilité pour Internet Explorer</a
            >
          </li>
          <li><a href="#servir-des-images-webp">Servir des images WebP</a></li>
        </ul>
      </li>
    </ul>
    <h2 id="réécriture-et-redirection">Réécriture et redirection</h2>
    <p>
      Remarque: On suppose avoir le module <code>mod_rewrite</code> installé et
      activé.
    </p>
    <h3 id="forcer-www">Forcer www</h3>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^example\.com [NC]
RewriteRule ^(.*)$ http://www.example.com/$1 [L,R=301,NC]</code></pre>
    <h3 id="forcer-www-dune-manière-générique">
      Forcer www d’une manière générique
    </h3>
    <pre class="apacheconf"><code>RewriteCond %{HTTP_HOST} !^$
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTPS}s ^on(s)|
RewriteRule ^ http%1://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]</code></pre>
    <p>
      Cela fonctionne pour <em>tous</em> les domaines.
      <a
        href="https://stackoverflow.com/questions/4916222/htaccess-how-to-force-www-in-a-generic-way"
        >Source</a
      >
    </p>
    <h3 id="forcer-non-www">Forcer non-www</h3>
    <p>
      C’est
      <a href="http://www.sitepoint.com/domain-www-or-no-www/">toujours</a>
      <a href="https://devcenter.heroku.com/articles/apex-domains">en cours</a>
      <a href="http://yes-www.org/">de</a>
      <a href="http://no-www.org/">débat</a> selon s’il faut prévilégier la
      forme avec ou sans <code>www</code>, donc si vous êtes un fan de domaine
      “à nu”, ceci est pour vous :
    </p>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^www\.example\.com [NC]
RewriteRule ^(.*)$ http://example.com/$1 [L,R=301]</code></pre>
    <h3 id="forcer-non-www-dune-manière-générique">
      Forcer non-www d’une manière générique
    </h3>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_HOST} ^www\.
RewriteCond %{HTTPS}s ^on(s)|off
RewriteCond http%1://%{HTTP_HOST} ^(https?://)(www\.)?(.+)$
RewriteRule ^ %1%3%{REQUEST_URI} [R=301,L]</code></pre>
    <h3 id="forcer-https">Forcer HTTPS</h3>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTPS} !on
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}</code></pre>
    <h3 id="forcer-https-derrière-un-proxy">Forcer HTTPS derrière un proxy</h3>
    <p>
      Ceci est utile si vous avez un proxy devant votre serveur faisant une
      termination TLS :
    </p>
    <pre class="apacheconf"><code>RewriteCond %{HTTP:X-Forwarded-Proto} !https
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}</code></pre>
    <h3 id="forcer-le-slash-de-fin">Forcer le slash de fin</h3>
    <pre class="apacheconf"><code>RewriteCond %{REQUEST_URI} /+[^\.]+$
RewriteRule ^(.+[^/])$ %{REQUEST_URI}/ [R=301,L]</code></pre>
    <h3 id="supprimer-le-slash-de-fin">Supprimer le slash de fin</h3>
    <pre class="apacheconf"><code>RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [R=301,L]</code></pre>
    <h3 id="rediriger-une-seule-page">Rediriger une seule page</h3>
    <pre
      class="apacheconf"
    ><code>Redirect 301 /anciennepage.html http://www.votresite.com/nouvellepage.html
Redirect 301 /anciennepage2.html http://www.votresite.com/dossier/</code></pre>
    <p>
      <a href="http://css-tricks.com/snippets/htaccess/301-redirects/"
        >Source</a
      >
    </p>
    <h3 id="alias-pour-un-seul-dossier">Alias pour un seul dossier</h3>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteRule ^source-directory/(.*) target-directory/$1</code></pre>
    <h3 id="alias-de-chemins-vers-un-script">
      Alias de chemins vers un script
    </h3>
    <pre class="apacheconf"><code>FallbackResource /index.fcgi</code></pre>
    <p>
      Cet exemple a un fichier <code>index.fcgi</code> dans un répertoire, et
      toutes les requêtes à l’intérieur de ce dossier qui ne peuvent résoudre le
      fichier/dossier demandé seront renvoyées vers le script
      <code>index.fcgi</code>. Ceci est utile si vous souhaitez que
      <code>baz.foo/une/route/sympa</code> soit manipulé par
      <code>baz.foo/index.fcgi</code> (qui prend également en charge les
      demandes vers <code>baz.foo</code>) tout en maintenant
      <code>baz.foo/css/style.css</code> ou autre fonctionnels. Accédez au
      chemin d’origine de la variable d’environnement <code>PATH_INFO</code>,
      comme exposé à votre environnement de scriptage.
    </p>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteRule ^$ index.fcgi/ [QSA,L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.fcgi/$1 [QSA,L]</code></pre>
    <p>
      Ceci est une version moins efficace de la directive
      <code>FallbackResource</code> (car l’utilisation de
      <code>mod_rewrite</code> est plus complexe que de maintenir la directive
      <code>FallbackResource</code>), mais offre d’avantage de flexibilité.
    </p>
    <h3 id="rediriger-un-site-entier">Rediriger un site entier</h3>
    <pre
      class="apacheconf"
    ><code>Redirect 301 / http://nouveausite.com/</code></pre>
    <p>
      Ceci laisse les liens intacts. Ainsi
      <code>anciensite.com/lien/super/genial.html</code> deviendra
      <code>nouveausite.com/lien/super/genial.html</code>. Cela est très
      pratique lorsque vous souhaitez déplacer un site vers un nouveau domaine.
    </p>
    <p>
      <a href="http://css-tricks.com/snippets/htaccess/301-redirects/"
        >Source</a
      >
    </p>
    <h3 id="alias-en-urls-propres">Alias en URLs propres</h3>
    <p>
      Ce snippet vous permet d’utiliser des “URLs propres” –celles sans
      extension–, par exemple : <code>example.com/users</code> à la place de
      <code>example.com/users.php</code>.
    </p>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteCond %{SCRIPT_FILENAME} !-d
RewriteRule ^([^.]+)$ $1.php [NC,L]</code></pre>
    <p>
      <a
        href="http://www.abeautifulsite.net/access-pages-without-the-php-extension-using-htaccess/"
        >Source</a
      >
    </p>
    <h2 id="securité">Securité</h2>
    <h3 id="refuser-tout-accès">Refuser tout accès</h3>
    <pre class="apacheconf"><code>## Apache 2.2
Deny from all

## Apache 2.4
# Require all denied</code></pre>
    <p>
      Mais… ceci vous bloquera vous également ! Si ce n’est pas ce que vous
      souhaitez, la partie suivante est sûrement faite pour vous !
    </p>
    <h3 id="refuser-tout-accès-sauf-soi-même">
      Refuser tout accès sauf soi-même
    </h3>
    <pre class="apacheconf"><code>## Apache 2.2
Order deny,allow
Deny from all
Allow from xxx.xxx.xxx.xxx

## Apache 2.4
# Require all denied
# Require ip xxx.xxx.xxx.xxx</code></pre>
    <p>
      En remplaçant <code>xxx.xxx.xxx.xxx</code> par votre adresse IP, vous
      n’autoriserez l’accès à votre site que par vous. Si vous remplacez les 3
      dernièrs numéros par <code>0/12</code> par exemple, ceci spécifiera un
      intervalle d’adresses IPs à l’intérieur d’un même réseau, vous évitant
      ainsi de lister toutes les IPs autorisées individuellement.
    </p>
    <p>
      <a
        href="http://speckyboy.com/2013/01/08/useful-htaccess-snippets-and-hacks/"
        >Source</a
      >
    </p>
    <p>Bien sûr, il y a la version inverse :</p>
    <h3 id="autoriser-tout-accès-sauf-aux-spammeurs">
      Autoriser tout accès sauf aux spammeurs
    </h3>
    <pre class="apacheconf"><code>## Apache 2.2
Order deny,allow
Deny from xxx.xxx.xxx.xxx
Deny from xxx.xxx.xxx.xxy

## Apache 2.4
# Require all granted
# Require not ip xxx.xxx.xxx.xxx
# Require not ip xxx.xxx.xxx.xxy</code></pre>
    <h3 id="refuser-laccès-aux-fichiers-et-dossiers-cachés">
      Refuser l’accès aux fichiers et dossiers cachés
    </h3>
    <p>
      Les fichiers et dossiers cachés (ceux dont les noms commencent par un
      point <code>.</code>) devraient être pour la majorité d’entre eux
      sécurisés. On ne devrait par exemple pas avoir accès aux éléments suivants
      : <code>.htaccess</code>, <code>.htpasswd</code>, <code>.git</code>,
      <code>.hg</code>…
    </p>
    <pre class="apacheconf"><code>RewriteCond %{SCRIPT_FILENAME} -d [OR]
RewriteCond %{SCRIPT_FILENAME} -f
RewriteRule &quot;(^|/)\.&quot; - [F]</code></pre>
    <p>
      Une autre solution serait de lever une erreur <code>404 Not Found</code>,
      ne donnant aucun indice à l’attaquant quant à l’existance de la ressource
      :
    </p>
    <pre class="apacheconf"><code>RedirectMatch 404 /\..*$</code></pre>
    <h3 id="refuser-laccès-aux-sources-et-fichiers-de-sauvegarde">
      Refuser l’accès aux sources et fichiers de sauvegarde
    </h3>
    <p>
      Ces fichiers peuvent être laissés par certains éditeurs de texte/html
      (comme Vi/Vim) et poser un grand danger en terme de sécurité, quand
      quelqu’un y a accès.
    </p>
    <pre
      class="apacheconf"
    ><code>&lt;FilesMatch &quot;(\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|swp)|~)$&quot;&gt;
    ## Apache 2.2
    Order allow,deny
    Deny from all
    Satisfy All

    ## Apache 2.4
    # Require all denied
&lt;/FilesMatch&gt;</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Source</a></p>
    <h3 id="désactiver-la-navigation-de-dossier">
      Désactiver la navigation de dossier
    </h3>
    <pre class="apacheconf"><code>Options All -Indexes</code></pre>
    <h3 id="désactiver-le-hotlink-des-images">
      Désactiver le hotlink des images
    </h3>
    <pre class="apacheconf"><code>RewriteEngine on
# Enlever la ligne ci-dessous si vous souhaitez bloquer le referrer vide 
RewriteCond %{HTTP_REFERER} !^$

RewriteCond %{HTTP_REFERER} !^http(s)?://(.+\.)?votredomaine.com [NC]
RewriteRule \.(jpg|jpeg|png|gif|bmp)$ - [NC,F,L]

# Si vous souhaitez afficher une bannière &quot;Bloquée&quot; d&#39;url &#39;blocked.png&#39; au lieu
# du hotlink de l&#39;image, replacez la règle ci-dessus par celle-ci :
# RewriteRule \.(jpg|jpeg|png|gif|bmp) http://votredomaine.com/blocked.png [R,L]</code></pre>
    <h3 id="désactiver-le-hotlink-des-images-pour-des-domaines-spécifiques">
      Désactiver le hotlink des images pour des domaines spécifiques
    </h3>
    <p>
      Parfois vous souhaitez désactiver le hotlink d’images seulement pour
      quelques domaines spécifiques. L’extrait suivant devrait vous aider :
    </p>
    <pre class="apacheconf"><code>RewriteEngine on
RewriteCond %{HTTP_REFERER} ^http(s)?://(.+\.)?mauvaissite\.com [NC,OR]
RewriteCond %{HTTP_REFERER} ^http(s)?://(.+\.)?mauvaissite2\.com [NC,OR]
RewriteRule \.(jpg|jpeg|png|gif)$ - [NC,F,L]

# Si vous souhaitez afficher une bannière &quot;Bloquée&quot; d&#39;url &#39;blocked.png&#39; au lieu
# du hotlink de l&#39;image, replacez la règle ci-dessus par celle-ci :
# RewriteRule \.(jpg|jpeg|png|gif|bmp) http://votredomaine.com/blocked.png [R,L]</code></pre>
    <h3 id="protéger-un-dossier-par-mot-de-passe">
      Protéger un dossier par mot de passe
    </h3>
    <p>
      D’abord, vous aurez besoin de créer un fichier
      <code>.htpasswd</code> quelque part sur le système, avec l’aide de la
      commande suivante :
    </p>
    <div class="sourceCode" id="cb24">
      <pre
        class="sourceCode bash"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1"><span class="ex">htpasswd</span> -c /home/fellowship/.htpasswd boromir</a></code></pre>
    </div>
    <p>Ensuite, vous pouvez utiliser ceci pour activer l’authentification :</p>
    <pre class="apacheconf"><code>AuthType Basic
AuthName &quot;One does not simply&quot;
AuthUserFile /home/fellowship/.htpasswd
Require valid-user</code></pre>
    <h3 id="protéger-un-ou-plusieurs-fichiers-par-mot-de-passe">
      Protéger un ou plusieurs fichiers par mot de passe
    </h3>
    <pre class="apacheconf"><code>AuthName &quot;One still does not simply&quot;
AuthType Basic
AuthUserFile /home/fellowship/.htpasswd

&lt;Files &quot;one-ring.o&quot;&gt;
Require valid-user
&lt;/Files&gt;

&lt;FilesMatch ^((one|two|three)-rings?\.o)$&gt;
Require valid-user
&lt;/FilesMatch&gt;</code></pre>
    <h2 id="performance">Performance</h2>
    <h3 id="compresser-les-fichiers-texte">Compresser les fichiers texte</h3>
    <pre class="apacheconf"><code>&lt;IfModule mod_deflate.c&gt;

    # Force compression for mangled headers.
    # https://developer.yahoo.com/blogs/ydn/pushing-beyond-gzipping-25601.html
    &lt;IfModule mod_setenvif.c&gt;
        &lt;IfModule mod_headers.c&gt;
            SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s*,?\s*)+|[X~-]{4,13}$ HAVE_Accept-Encoding
            RequestHeader append Accept-Encoding &quot;gzip,deflate&quot; env=HAVE_Accept-Encoding
        &lt;/IfModule&gt;
    &lt;/IfModule&gt;

    # Compresse toutes les sorties ayant un de ces types MIME
    # (pour Apache &lt; 2.3.7, vous n&#39;avez pas besoin d&#39;activer `mod_filter`
    #  et vous pouvez supprimer le `&lt;IfModule mod_filter.c&gt;` et `&lt;/IfModule&gt;`
    #  comme `AddOutputFilterByType` sera toujours dans les directives du noyau).
    &lt;IfModule mod_filter.c&gt;
        AddOutputFilterByType DEFLATE application/atom+xml \
                                      application/javascript \
                                      application/json \
                                      application/rss+xml \
                                      application/vnd.ms-fontobject \
                                      application/x-font-ttf \
                                      application/x-web-app-manifest+json \
                                      application/xhtml+xml \
                                      application/xml \
                                      font/opentype \
                                      image/svg+xml \
                                      image/x-icon \
                                      text/css \
                                      text/html \
                                      text/plain \
                                      text/x-component \
                                      text/xml
    &lt;/IfModule&gt;

&lt;/IfModule&gt;</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Source</a></p>
    <h3 id="ajouter-len-tête-expires">Ajouter l’en-tête “Expires”</h3>
    <p>
      L’en-tête <em>Expires</em> indique au navigateur s’il doit effectuer une
      requête au serveur pour récupérer un fichier spécifique ou bien se
      contenter du cache. On peut conseiller pour les contenus statiques un
      en-tête d’expiration loin dans le futur.
    </p>
    <p>
      Si vous n’utilisez pas la méthode du nom de fichier modifié par un système
      de contrôle de version, vous devriez diminuer le temps de cache des
      ressources telles que les fichiers CSS ou JS vers quelque chose proche de
      la semaine.
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_expires.c&gt;
    ExpiresActive on
    ExpiresDefault                                      &quot;access plus 1 month&quot;

  # CSS
    ExpiresByType text/css                              &quot;access plus 1 year&quot;

  # Data interchange
    ExpiresByType application/json                      &quot;access plus 0 seconds&quot;
    ExpiresByType application/xml                       &quot;access plus 0 seconds&quot;
    ExpiresByType text/xml                              &quot;access plus 0 seconds&quot;

  # Favicon (cannot be renamed!)
    ExpiresByType image/x-icon                          &quot;access plus 1 week&quot;

  # HTML components (HTCs)
    ExpiresByType text/x-component                      &quot;access plus 1 month&quot;

  # HTML
    ExpiresByType text/html                             &quot;access plus 0 seconds&quot;

  # JavaScript
    ExpiresByType application/javascript                &quot;access plus 1 year&quot;

  # Manifest files
    ExpiresByType application/x-web-app-manifest+json   &quot;access plus 0 seconds&quot;
    ExpiresByType text/cache-manifest                   &quot;access plus 0 seconds&quot;

  # Media
    ExpiresByType audio/ogg                             &quot;access plus 1 month&quot;
    ExpiresByType image/gif                             &quot;access plus 1 month&quot;
    ExpiresByType image/jpeg                            &quot;access plus 1 month&quot;
    ExpiresByType image/png                             &quot;access plus 1 month&quot;
    ExpiresByType video/mp4                             &quot;access plus 1 month&quot;
    ExpiresByType video/ogg                             &quot;access plus 1 month&quot;
    ExpiresByType video/webm                            &quot;access plus 1 month&quot;

  # Web feeds
    ExpiresByType application/atom+xml                  &quot;access plus 1 hour&quot;
    ExpiresByType application/rss+xml                   &quot;access plus 1 hour&quot;

  # Web fonts
    ExpiresByType application/font-woff2                &quot;access plus 1 month&quot;
    ExpiresByType application/font-woff                 &quot;access plus 1 month&quot;
    ExpiresByType application/vnd.ms-fontobject         &quot;access plus 1 month&quot;
    ExpiresByType application/x-font-ttf                &quot;access plus 1 month&quot;
    ExpiresByType font/opentype                         &quot;access plus 1 month&quot;
    ExpiresByType image/svg+xml                         &quot;access plus 1 month&quot;
&lt;/IfModule&gt;</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Source</a></p>
    <h3 id="désactiver-etags">Désactiver eTags</h3>
    <p>
      En retirant l’en-tête “eTag”, vous empêchez le cache et les navigateurs de
      pouvoir valider les fichiers, ils sont donc forcés de se baser sur le
      Cache-Control (contrôle de cache) et les Expires header (en-tête
      d’expiration).
    </p>
    <p>
      <a href="http://www.askapache.com/htaccess/apache-speed-etags.html"
        >Source</a
      >
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_headers.c&gt;
    Header unset ETag
&lt;/IfModule&gt;
FileETag None</code></pre>
    <h2 id="divers">Divers</h2>
    <h3 id="définir-des-variables-php">Définir des variables PHP</h3>
    <pre class="apacheconf"><code>php_value &lt;key&gt; &lt;val&gt;

# Par exemple :
php_value upload_max_filesize 50M
php_value max_execution_time 240</code></pre>
    <h3 id="pages-derreur-personnalisées">Pages d’erreur personnalisées</h3>
    <pre
      class="apacheconf"
    ><code>ErrorDocument 500 &quot;Houston, on a un problème.&quot;
ErrorDocument 401 http://error.votredomaine.com/mordor.html
ErrorDocument 404 /errors/halflife3.html</code></pre>
    <h3 id="forcer-le-téléchargement">Forcer le téléchargement</h3>
    <p>
      Parfois, vous souhaitez forcer le navigateur à télécharger certaines
      ressources au lieu de les afficher. Le snippet suivant vous sera utile :
    </p>
    <pre class="apacheconf"><code>&lt;Files *.md&gt;
    ForceType application/octet-stream
    Header set Content-Disposition attachment
&lt;/Files&gt;</code></pre>
    <p>Si vous souhaitez l’action inverse :</p>
    <h3 id="empêcher-le-téléchargement">Empêcher le téléchargement</h3>
    <p>
      Parfois, vous souhaitez forcer le navigateur à afficher certains contenus
      au lieu de les télécharger. Le snippet suivant devrait vous aider :
    </p>
    <pre
      class="apacheconf"
    ><code>&lt;FilesMatch &quot;\.(tex|log|aux)$&quot;&gt;
    Header set Content-Type text/plain
&lt;/FilesMatch&gt;</code></pre>
    <h3 id="autoriser-les-polices-cross-domain">
      Autoriser les polices Cross-Domain
    </h3>
    <p>
      Les polices desservies par un serveur CDN peuvent ne pas fonctionner sur
      Firefox ou IE à cause de
      <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing"
        >CORS</a
      >. Le snippet suivant de
      <a href="https://github.com/h5bp/server-configs-apache/issues/32"
        >alrra</a
      >
      devrait corriger cela :
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_headers.c&gt;
    &lt;FilesMatch &quot;\.(eot|otf|ttc|ttf|woff|woff2)$&quot;&gt;
        Header set Access-Control-Allow-Origin &quot;*&quot;
    &lt;/FilesMatch&gt;
&lt;/IfModule&gt;</code></pre>
    <h3 id="encodage-utf-8-automatique">Encodage UTF-8 automatique</h3>
    <p>Votre contenu textuel devrait toujours être encodé en UTF-8, non ?</p>
    <pre
      class="apacheconf"
    ><code># Utiliser l&#39;encodage UTF-8 pour tout ce qui est servi en text/plain ou text/html
AddDefaultCharset utf-8

# Forcer l&#39;UTF-8 pour certains formats de fichier
AddCharset utf-8 .atom .css .js .json .rss .vtt .xml</code></pre>
    <p><a href="https://github.com/h5bp/server-configs-apache">Source</a></p>
    <h3 id="basculer-vers-une-autre-version-de-php">
      Basculer vers une autre version de PHP
    </h3>
    <p>
      Si vous êtes sur un serveur mutualisé, il y a des chances pour qu’il y ait
      plus d’une version de PHP installée, et parfois, vous avez besoin d’une
      version spécifique pour votre site web.
    </p>
    <p>
      Par exemple
      <a href="https://github.com/laravel/laravel">Laravel</a> nécessite PHP
      &gt;= 5.4. Le snippet suivant devrait passer d’une version à l’autre de
      PHP pour vous :
    </p>
    <pre class="apacheconf"><code>AddHandler application/x-httpd-php55 .php

# Autrement, vous pouvez utiliser AddType
AddType application/x-httpd-php55 .php</code></pre>
    <h3 id="désactiver-le-mode-de-compatibilité-pour-internet-explorer">
      Désactiver le mode de compatibilité pour Internet Explorer
    </h3>
    <p>
      Le mode de compatibilité dans IE peut affecter l’affichage de certains
      sites web. L’extrait suivant devrait forcer IE à utiliser le moteur
      d’interprétation Edge et ainsi désactiver le mode de compatibilité.
    </p>
    <pre class="apacheconf"><code>&lt;IfModule mod_headers.c&gt;
    BrowserMatch MSIE is-msie
    Header set X-UA-Compatible IE=edge env=is-msie
&lt;/IfModule&gt;</code></pre>
    <h3 id="servir-des-images-webp">Servir des images WebP</h3>
    <p>
      Si
      <a href="https://developers.google.com/speed/webp/?csw=1">WebP images</a>
      est supporté et que l’image avec l’extension <code>.webp</code> a le même
      nom qu’une image jpg/png alors l’image Webp sera servie à la place.
    </p>
    <pre class="apacheconf"><code>RewriteEngine On
RewriteCond %{HTTP_ACCEPT} image/webp
RewriteCond %{DOCUMENT_ROOT}/$1.webp -f
RewriteRule (.+)\.(jpe?g|png)$ $1.webp [T=image/webp,E=accept:1]</code></pre>
    <p>
      <a href="https://github.com/vincentorback/WebP-images-with-htaccess"
        >Source</a
      >
    </p>
  </body>
</html>
